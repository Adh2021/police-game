<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Summerville PD: Target Zero</title>
    
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script src="https://cdn.tailwindcss.com"></script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>

    <style>
        body { 
            background-color: #020617; 
            touch-action: none; /* Prevents scroll on mobile swipe */
            user-select: none;
            overflow: hidden;
        }
        /* Custom Scrollbar hide */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion, useMotionValue, useTransform } = window.Motion;

        // --- ICONS (Simple SVG replacement since Lucide React component isn't direct in CDN) ---
        const ShieldIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>;
        const UsersIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>;
        const DollarIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>;
        const SkullIcon = ({ className }) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="M12.5 17l-.5-1-.5 1h1z"/><path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"/></svg>;

        // --- GAME ENGINE ---
        const LOCATIONS = ["Historic District", "Berlin G. Myers Pkwy", "I-26 (Exit 199)", "Nexton Square", "Bacons Bridge Rd", "Trolley Rd", "Dorchester Rd"];
        const VEHICLES = ["Squatted Tahoe", "Beat-up Altima", "Luxury BMW", "Contractor's F-150", "Tourist Minivan", "Modded Civic", "Harley Davidson"];
        
        const SCENARIOS = [
            {
                type: "SPEED",
                text: (v, l) => `${v} clocked at 95mph on ${l}. Heavy traffic.`,
                left: { label: "PIT Maneuver", order: 15, trust: -10, budget: -5, casualtyRisk: 40 },
                right: { label: "Log Ticket", order: -5, trust: 5, budget: 10, casualtyRisk: 0 }
            },
            {
                type: "DUI",
                text: (v, l) => `${v} swerving across lanes on ${l}. Looks drunk.`,
                left: { label: "Force Stop", order: 20, trust: 5, budget: -10, casualtyRisk: 25 },
                right: { label: "Follow", order: -10, trust: -5, budget: 0, casualtyRisk: 10 }
            },
            {
                type: "DISTURBANCE",
                text: (v, l) => `Noise complaint. ${v} blasting music in ${l}.`,
                left: { label: "Seize Car", order: 5, trust: -20, budget: 5, casualtyRisk: 5 },
                right: { label: "Warning", order: -5, trust: 10, budget: 0, casualtyRisk: 0 }
            },
            {
                type: "INTERSTATE",
                text: (v, l) => `Wrong way driver on ${l}! It's a ${v}.`,
                left: { label: "Head-on Block", order: 50, trust: 50, budget: -100, casualtyRisk: 80 },
                right: { label: "Spike Strips", order: 20, trust: 10, budget: -5, casualtyRisk: 10 }
            }
        ];

        function generateCard(turnCount) {
            // Boss Event every 10 turns
            if (turnCount > 0 && turnCount % 10 === 0) {
                return {
                    id: `boss_${turnCount}`,
                    title: "SHIFT REPORT",
                    text: "Chief: 'I'm looking at your casualty reports. Don't make me regret hiring you.'",
                    image: "ðŸ‘®â€â™‚ï¸",
                    left: { label: "Dismiss", order: -5, trust: -5, budget: 0, casualtyRisk: 0 },
                    right: { label: "Yes Sir", order: 5, trust: 5, budget: 0, casualtyRisk: 0 }
                };
            }
            
            const scenario = SCENARIOS[Math.floor(Math.random() * SCENARIOS.length)];
            const location = LOCATIONS[Math.floor(Math.random() * LOCATIONS.length)];
            const vehicle = VEHICLES[Math.floor(Math.random() * VEHICLES.length)];
            
            return {
                id: `turn_${turnCount}`,
                title: "DISPATCH ALERT",
                text: scenario.text(vehicle, location),
                image: "ðŸš”",
                left: scenario.left,
                right: scenario.right
            };
        }

        // --- COMPONENTS ---

        const Meter = ({ icon, val, color, label }) => (
            <div className="flex flex-col items-center gap-1 w-full">
                <div className="w-full h-1 bg-slate-800 rounded-full relative overflow-hidden">
                    <div 
                        className={`absolute left-0 h-full transition-all duration-500 ${color}`} 
                        style={{ width: `${val}%` }} 
                    />
                </div>
                <div className="flex items-center gap-1 text-slate-500">
                    {icon}
                    <span className="text-[10px] font-mono uppercase">{label}</span>
                </div>
            </div>
        );

        const Card = ({ data, onSwipe }) => {
            const x = useMotionValue(0);
            const rotate = useTransform(x, [-200, 200], [-25, 25]);
            const opacityLeft = useTransform(x, [0, -100], [0, 1]); // Red overlay
            const opacityRight = useTransform(x, [0, 100], [0, 1]); // Green overlay
            
            // Background color hint based on drag
            const bg = useTransform(x, [-150, 0, 150], ["rgba(239, 68, 68, 0.1)", "rgba(30, 41, 59, 1)", "rgba(59, 130, 246, 0.1)"]);

            const handleDragEnd = (_, info) => {
                if (info.offset.x > 100) onSwipe("right");
                else if (info.offset.x < -100) onSwipe("left");
            };

            return (
                <div className="relative w-full max-w-sm h-[450px] mx-auto mt-4 perspective-1000">
                    <motion.div
                        style={{ x, rotate, backgroundColor: bg }}
                        drag="x"
                        dragConstraints={{ left: 0, right: 0 }}
                        onDragEnd={handleDragEnd}
                        className="absolute w-full h-full bg-slate-800 rounded-xl shadow-2xl border border-slate-700 flex flex-col items-center justify-between p-6 cursor-grab active:cursor-grabbing z-10 overflow-hidden"
                    >
                        {/* OVERLAYS */}
                        <motion.div style={{ opacity: opacityRight }} className="absolute inset-0 bg-blue-500/20 z-20 pointer-events-none flex items-center justify-center">
                             <div className="border-4 border-blue-400 text-blue-400 font-bold text-4xl p-2 rounded -rotate-12 uppercase tracking-widest">{data.right.label}</div>
                        </motion.div>
                        <motion.div style={{ opacity: opacityLeft }} className="absolute inset-0 bg-red-500/20 z-20 pointer-events-none flex items-center justify-center">
                             <div className="border-4 border-red-500 text-red-500 font-bold text-4xl p-2 rounded rotate-12 uppercase tracking-widest">{data.left.label}</div>
                        </motion.div>

                        {/* CONTENT */}
                        <div className="w-full">
                            <div className="flex justify-between items-center text-slate-500 text-[10px] font-mono mb-2 uppercase tracking-widest border-b border-slate-700 pb-2">
                                <span>{data.title}</span>
                                <span>{data.id}</span>
                            </div>
                            <div className="text-7xl text-center my-8">{data.image}</div>
                            <h3 className="text-slate-100 text-xl font-bold text-center leading-snug">
                                {data.text}
                            </h3>
                        </div>

                        <div className="text-slate-600 text-[10px] font-mono uppercase tracking-widest mt-auto">
                            &larr; Swipe to Decide &rarr;
                        </div>
                    </motion.div>
                    
                    {/* Stack Effect */}
                    <div className="absolute top-3 left-0 w-full h-full bg-slate-900 rounded-xl border border-slate-800 -z-10 scale-[0.95] opacity-50"></div>
                </div>
            );
        };

        const App = () => {
            const [turn, setTurn] = useState(0);
            const [card, setCard] = useState(null);
            const [gameOver, setGameOver] = useState(null);
            
            const [stats, setStats] = useState({
                order: 50,
                trust: 50,
                budget: 50,
                casualties: 0
            });

            // Init / Load Save
            useEffect(() => {
                const saved = localStorage.getItem("summerville_save");
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        if (!data.gameOver) {
                            setStats(data.stats);
                            setTurn(data.turn);
                            setCard(generateCard(data.turn));
                            return;
                        }
                    } catch (e) { console.error("Save corrupted"); }
                }
                startNewRun();
            }, []);

            // Auto Save
            useEffect(() => {
                localStorage.setItem("summerville_save", JSON.stringify({ stats, turn, gameOver }));
            }, [stats, turn, gameOver]);

            const startNewRun = () => {
                setStats({ order: 50, trust: 50, budget: 50, casualties: 0 });
                setTurn(1);
                setGameOver(null);
                setCard(generateCard(1));
            };

            const handleSwipe = (dir) => {
                if(!card) return;
                const choice = dir === "left" ? card.left : card.right;
                
                // Risk Calc
                let casualty = 0;
                if (choice.casualtyRisk > 0 && Math.random() * 100 < choice.casualtyRisk) {
                    casualty = 1;
                }

                const newStats = {
                    order: Math.min(100, Math.max(0, stats.order + choice.order)),
                    trust: Math.min(100, Math.max(0, stats.trust + choice.trust)),
                    budget: Math.min(100, Math.max(0, stats.budget + choice.budget)),
                    casualties: stats.casualties + casualty
                };

                setStats(newStats);

                // Game Over Checks
                if (newStats.casualties > 0) return setGameOver("TARGET ZERO FAILED: CIVILIAN FATALITY");
                if (newStats.order <= 0) return setGameOver("FIRED: CITY LOST TO CRIME");
                if (newStats.trust <= 0) return setGameOver("FIRED: PUBLIC OUTCRY");
                if (newStats.budget <= 0) return setGameOver("DEFUNDED: DEPARTMENT BANKRUPT");

                setTurn(t => t + 1);
                setCard(generateCard(turn + 1));
            };

            return (
                <div className="h-screen w-screen flex flex-col bg-slate-950 text-white font-sans overflow-hidden">
                    
                    {/* HUD */}
                    <header className="p-4 pt-6 bg-slate-900 border-b border-slate-800 shadow-lg z-50">
                        <div className="flex justify-between items-center mb-4">
                            <h1 className="text-sm font-bold tracking-widest text-slate-400">SUMMERVILLE PD</h1>
                            <div className={`flex items-center gap-2 px-3 py-1 rounded bg-slate-800 border ${stats.casualties > 0 ? 'border-red-500 text-red-500 animate-pulse' : 'border-slate-700 text-slate-400'}`}>
                                <SkullIcon className="w-4 h-4" />
                                <span className="text-xs font-mono font-bold">ZERO</span>
                            </div>
                        </div>
                        <div className="grid grid-cols-3 gap-4">
                            <Meter icon={<ShieldIcon/>} val={stats.order} color="bg-blue-500" label="Order" />
                            <Meter icon={<UsersIcon/>} val={stats.trust} color="bg-green-500" label="Trust" />
                            <Meter icon={<DollarIcon/>} val={stats.budget} color="bg-yellow-500" label="Budget" />
                        </div>
                    </header>

                    {/* MAIN GAME */}
                    <main className="flex-1 flex flex-col items-center justify-center p-4 relative">
                        {gameOver ? (
                            <div className="w-full max-w-sm bg-slate-900 border border-red-900/50 p-8 rounded-xl text-center shadow-2xl animate-[fadeIn_0.5s_ease-out]">
                                <SkullIcon className="w-16 h-16 text-red-600 mx-auto mb-4" />
                                <h2 className="text-2xl font-black text-white mb-2 tracking-tighter">SHIFT ENDED</h2>
                                <div className="h-1 w-16 bg-red-600 mx-auto mb-6"></div>
                                <p className="text-red-400 font-mono mb-8 text-sm">{gameOver}</p>
                                <div className="text-slate-500 text-xs mb-6 font-mono">TURNS SURVIVED: {turn}</div>
                                <button 
                                    onClick={startNewRun}
                                    className="w-full py-4 bg-red-600 hover:bg-red-500 text-white font-bold rounded shadow-lg active:scale-95 transition-transform uppercase tracking-widest"
                                >
                                    Start New Shift
                                </button>
                            </div>
                        ) : (
                            card && <Card key={card.id} data={card} onSwipe={handleSwipe} />
                        )}
                    </main>

                    {/* FOOTER */}
                    <footer className="p-3 text-center text-slate-700 text-[10px] font-mono tracking-widest">
                        OFFLINE PWA â€¢ TARGET ZERO PROTOCOL v1.0
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
